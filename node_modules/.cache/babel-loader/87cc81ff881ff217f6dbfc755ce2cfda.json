{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { wait } from '@/utils/helpers';\nimport { defineStore } from 'pinia';\nconst FETCH_ATTEMPTS_COUNT = 3;\nconst FETCH_DELAY_REQUEST_MS = 3000;\nconst BASE_URL = 'https://fakestoreapi.com/products';\nconst FETCH_ERROR_MESSAGE = \"Something went wrong. I'll try to fetch data again in\";\nconst SERVER_ERROR_MESSAGE = 'We are sorry. Server is temporarily down. Please try again later';\nexport const useProductStore = defineStore('products', {\n  state: () => {\n    return {\n      products: [],\n      isLoading: false,\n      error: {\n        isError: false,\n        message: null,\n        errorCode: null,\n        type: null,\n        timeout: null\n      },\n      serverStatus: {\n        isDown: false,\n        message: null\n      }\n    };\n  },\n  getters: {\n    isProducts: state => state.products.length > 0,\n    allCategories: state => {\n      const tmp = state.products.map(product => product.category);\n      tmp.unshift('all');\n      return [...new Set(tmp)];\n    },\n    product: state => id => {\n      return state.products.find(item => item.id === +id);\n    }\n  },\n  actions: {\n    async fetchProducts(attempt = 1) {\n      try {\n        this.isLoading = true;\n        const response = await fetch(BASE_URL);\n\n        if (!response.ok) {\n          await wait(1000);\n          throw new Error(FETCH_ERROR_MESSAGE, {\n            cause: {\n              status: response.status\n            }\n          });\n        }\n\n        this.products = await response.json();\n      } catch (e) {\n        this.isLoading = false;\n\n        if (attempt <= FETCH_ATTEMPTS_COUNT) {\n          this.error = {\n            isError: true,\n            message: e.message,\n            errorCode: e.cause.status,\n            timeout: attempt * (FETCH_DELAY_REQUEST_MS / 1000)\n          };\n          await wait(attempt * FETCH_DELAY_REQUEST_MS);\n          return this.fetchProducts(attempt + 1);\n        }\n\n        this.serverStatus = {\n          isDown: true,\n          message: SERVER_ERROR_MESSAGE\n        };\n      } finally {\n        this.isLoading = false;\n      }\n    }\n\n  }\n});","map":{"version":3,"names":["wait","defineStore","FETCH_ATTEMPTS_COUNT","FETCH_DELAY_REQUEST_MS","BASE_URL","FETCH_ERROR_MESSAGE","SERVER_ERROR_MESSAGE","useProductStore","state","products","isLoading","error","isError","message","errorCode","type","timeout","serverStatus","isDown","getters","isProducts","length","allCategories","tmp","map","product","category","unshift","Set","id","find","item","actions","fetchProducts","attempt","response","fetch","ok","Error","cause","status","json","e"],"sources":["/Users/tamirlankarimov/Desktop/Vue_Project_ecommerce/e-commerce-app/src/store/useProductStore.js"],"sourcesContent":["import { wait } from '@/utils/helpers';\nimport { defineStore } from 'pinia';\n\nconst FETCH_ATTEMPTS_COUNT = 3;\nconst FETCH_DELAY_REQUEST_MS = 3000;\nconst BASE_URL = 'https://fakestoreapi.com/products';\nconst FETCH_ERROR_MESSAGE = \"Something went wrong. I'll try to fetch data again in\";\nconst SERVER_ERROR_MESSAGE = 'We are sorry. Server is temporarily down. Please try again later';\n\nexport const useProductStore = defineStore('products', {\n  state: () => {\n    return {\n      products: [],\n      isLoading: false,\n      error: {\n        isError: false,\n        message: null,\n        errorCode: null,\n        type: null,\n        timeout: null,\n      },\n      serverStatus: {\n        isDown: false,\n        message: null,\n      },\n    };\n  },\n\n  getters: {\n    isProducts: (state) => state.products.length > 0,\n    allCategories: (state) => {\n      const tmp = state.products.map((product) => product.category);\n      tmp.unshift('all');\n      return [...new Set(tmp)];\n    },\n\n    product: (state) => (id) => {\n      return state.products.find((item) => item.id === +id);\n    },\n  },\n\n  actions: {\n    async fetchProducts(attempt = 1) {\n      try {\n        this.isLoading = true;\n\n        const response = await fetch(BASE_URL);\n\n        if (!response.ok) {\n          await wait(1000);\n          throw new Error(FETCH_ERROR_MESSAGE, { cause: { status: response.status } });\n        }\n\n        this.products = await response.json();\n      } catch (e) {\n        this.isLoading = false;\n\n        if (attempt <= FETCH_ATTEMPTS_COUNT) {\n          this.error = {\n            isError: true,\n            message: e.message,\n            errorCode: e.cause.status,\n            timeout: attempt * (FETCH_DELAY_REQUEST_MS / 1000),\n          };\n\n          await wait(attempt * FETCH_DELAY_REQUEST_MS);\n          return this.fetchProducts(attempt + 1);\n        }\n\n        this.serverStatus = { isDown: true, message: SERVER_ERROR_MESSAGE };\n      } finally {\n        this.isLoading = false;\n      }\n    },\n  },\n});\n"],"mappings":";AAAA,SAASA,IAAT,QAAqB,iBAArB;AACA,SAASC,WAAT,QAA4B,OAA5B;AAEA,MAAMC,oBAAoB,GAAG,CAA7B;AACA,MAAMC,sBAAsB,GAAG,IAA/B;AACA,MAAMC,QAAQ,GAAG,mCAAjB;AACA,MAAMC,mBAAmB,GAAG,uDAA5B;AACA,MAAMC,oBAAoB,GAAG,kEAA7B;AAEA,OAAO,MAAMC,eAAe,GAAGN,WAAW,CAAC,UAAD,EAAa;EACrDO,KAAK,EAAE,MAAM;IACX,OAAO;MACLC,QAAQ,EAAE,EADL;MAELC,SAAS,EAAE,KAFN;MAGLC,KAAK,EAAE;QACLC,OAAO,EAAE,KADJ;QAELC,OAAO,EAAE,IAFJ;QAGLC,SAAS,EAAE,IAHN;QAILC,IAAI,EAAE,IAJD;QAKLC,OAAO,EAAE;MALJ,CAHF;MAULC,YAAY,EAAE;QACZC,MAAM,EAAE,KADI;QAEZL,OAAO,EAAE;MAFG;IAVT,CAAP;EAeD,CAjBoD;EAmBrDM,OAAO,EAAE;IACPC,UAAU,EAAGZ,KAAD,IAAWA,KAAK,CAACC,QAAN,CAAeY,MAAf,GAAwB,CADxC;IAEPC,aAAa,EAAGd,KAAD,IAAW;MACxB,MAAMe,GAAG,GAAGf,KAAK,CAACC,QAAN,CAAee,GAAf,CAAoBC,OAAD,IAAaA,OAAO,CAACC,QAAxC,CAAZ;MACAH,GAAG,CAACI,OAAJ,CAAY,KAAZ;MACA,OAAO,CAAC,GAAG,IAAIC,GAAJ,CAAQL,GAAR,CAAJ,CAAP;IACD,CANM;IAQPE,OAAO,EAAGjB,KAAD,IAAYqB,EAAD,IAAQ;MAC1B,OAAOrB,KAAK,CAACC,QAAN,CAAeqB,IAAf,CAAqBC,IAAD,IAAUA,IAAI,CAACF,EAAL,KAAY,CAACA,EAA3C,CAAP;IACD;EAVM,CAnB4C;EAgCrDG,OAAO,EAAE;IACP,MAAMC,aAAN,CAAoBC,OAAO,GAAG,CAA9B,EAAiC;MAC/B,IAAI;QACF,KAAKxB,SAAL,GAAiB,IAAjB;QAEA,MAAMyB,QAAQ,GAAG,MAAMC,KAAK,CAAChC,QAAD,CAA5B;;QAEA,IAAI,CAAC+B,QAAQ,CAACE,EAAd,EAAkB;UAChB,MAAMrC,IAAI,CAAC,IAAD,CAAV;UACA,MAAM,IAAIsC,KAAJ,CAAUjC,mBAAV,EAA+B;YAAEkC,KAAK,EAAE;cAAEC,MAAM,EAAEL,QAAQ,CAACK;YAAnB;UAAT,CAA/B,CAAN;QACD;;QAED,KAAK/B,QAAL,GAAgB,MAAM0B,QAAQ,CAACM,IAAT,EAAtB;MACD,CAXD,CAWE,OAAOC,CAAP,EAAU;QACV,KAAKhC,SAAL,GAAiB,KAAjB;;QAEA,IAAIwB,OAAO,IAAIhC,oBAAf,EAAqC;UACnC,KAAKS,KAAL,GAAa;YACXC,OAAO,EAAE,IADE;YAEXC,OAAO,EAAE6B,CAAC,CAAC7B,OAFA;YAGXC,SAAS,EAAE4B,CAAC,CAACH,KAAF,CAAQC,MAHR;YAIXxB,OAAO,EAAEkB,OAAO,IAAI/B,sBAAsB,GAAG,IAA7B;UAJL,CAAb;UAOA,MAAMH,IAAI,CAACkC,OAAO,GAAG/B,sBAAX,CAAV;UACA,OAAO,KAAK8B,aAAL,CAAmBC,OAAO,GAAG,CAA7B,CAAP;QACD;;QAED,KAAKjB,YAAL,GAAoB;UAAEC,MAAM,EAAE,IAAV;UAAgBL,OAAO,EAAEP;QAAzB,CAApB;MACD,CA3BD,SA2BU;QACR,KAAKI,SAAL,GAAiB,KAAjB;MACD;IACF;;EAhCM;AAhC4C,CAAb,CAAnC"},"metadata":{},"sourceType":"module"}